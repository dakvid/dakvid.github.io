<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<meta name="date" content="2016-11-18" />

<title>Earthquake Depth</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="alternate" type="application/rss+xml" title="David's AdVentures In Data" href="/feed.xml">

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: -22px; }
.code-folding-btn.collapsed { margin-bottom: 4px; }
</style>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">David's AdVentures In Data</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-newspaper-o"></span>
     
    Posts
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="2016-11-earthquake-depth.html">Earthquake Depth</a>
    </li>
    <li>
      <a href="2016-11-simple-to-vote.html">Simple To Vote</a>
    </li>
    <li>
      <a href="2016-10-whither-local-democracy.html">W[h]ither Local Democracy?</a>
    </li>
    <li>
      <a href="2016-08-the-luminaries.html">The Luminaries</a>
    </li>
    <li>
      <a href="2016-08-unfamiliar-maps.html">Unfamiliar Maps</a>
    </li>
    <li>
      <a href="2016-08-birthday-eve.html">Birthday Eve</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="about.html">
        <span class="fa fa-question"></span>
         
        About Site
      </a>
    </li>
    <li>
      <a href="https://twitter.com/dakvid">
        <span class="fa fa-twitter"></span>
         
        Twitter
      </a>
    </li>
    <li>
      <a href="https://nz.linkedin.com/in/dfriggens">
        <span class="fa fa-linkedin"></span>
         
        LinkedIn
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="feed.xml">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Earthquake Depth</h1>
<h4 class="date"><em>18 November 2016</em></h4>

</div>


<p>There have been a number of interesting visualisations of this weeks earthquakes: I particularly like <a href="http://thespinoff.co.nz/science/15-11-2016/878-quakes-in-24-hours-how-new-zealand-shook-after-the-kaikoura-eqnz/">Chris McDowall’s</a>, but also <a href="https://twitter.com/kamal_hothi/status/797921821630705664">Harkanwal Singh’s</a>. Most of them focus on the two-dimensional geographic dimensions, which is important. A notable exception is the <a href="http://ellisp.github.io/blog/2016/11/15/piecharts">pie graph showing</a> that nearly half of the energy released by NZ earthquakes in seven years came on Monday.</p>
<p>I haven’t seen anything yet that gives a closer look at the depths of these earthquakes. The depth of the epicentre has an effect on the energy and damage at the surface, so this seems like an important factor. Some use colour to indicate depth, but it’s hard to get a feel for the distribution and variation. I thought it would be interesting to take a look at the quakes with depth as the primary dimension.</p>
<pre class="r"><code>library(readr)
library(tibble)
library(dplyr)
library(purrr)
library(lubridate)
library(ggplot2)
library(ggthemes)
library(gganimate)
library(ggmap)
library(png)</code></pre>
<p>Geonet lets us <a href="http://quakesearch.geonet.org.nz">search and download</a> earthquake data.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<pre class="r"><code>eqnz_raw &lt;- 
  # Sun 13 to Thu 17 November, but time stored in UTC
  #read_csv(&quot;http://quakesearch.geonet.org.nz/csv?bbox=163.60840,-49.18170,182.98828,-32.28713&amp;minmag=2&amp;startdate=2016-11-12T11:00:00&amp;enddate=2016-11-17T11:00:00&quot;)
  read_csv(&quot;data/earthquakes-2016-11-13--17.csv&quot;) %&gt;% 
  mutate(origintime = with_tz(origintime, &quot;Pacific/Auckland&quot;))</code></pre>
<p>If depth is your primary dimension then you’re probably going to have to give up your standard 2d geography. I picked a line bisecting the South Island as well I could (manually chosen in Google Maps — nothing special about it) that could serve as a reasonable 1d projection.</p>
<pre class="r"><code>nzsw_long &lt;- 166.46484
nzsw_lat &lt;- -47.18971
nzne_long &lt;- 178.90136
nzne_lat &lt;- -35.60371

png(filename = &quot;images/nz_projection_line.png&quot;)
ggmap::get_map(&quot;New Zealand&quot;, zoom = 5) %&gt;% 
  ggmap::ggmap() +
  coord_map() +
  geom_segment(x = nzsw_long, xend = nzne_long,
               y = nzsw_lat,  yend = nzne_lat,
               color = &quot;red&quot;)
dev.off()</code></pre>
<p><img src="images/nz_projection_line.png" alt="Map of NZ with projection line shown" /></p>
<p>With this we can plot (and animate) the depths. The quakes are plotted every hour, and faintly remain, to show the cumulative effect. It’s hard to get a realistic comparison of the magnitudes, given that it’s an exponential scale, so I’ve “highlighted” the larger ones in blue (&gt;5M), green (&gt;6M) and red (&gt;7M).</p>
<pre class="r"><code>get_projection &lt;- function(my_long, my_lat) {
  t &lt;- 
    ( (my_long - nzsw_long) * (nzne_long - nzsw_long) +
        (my_lat - nzsw_lat) * (nzne_lat - nzsw_lat) ) /
    ( (nzne_long - nzsw_long)^2 + (nzne_lat - nzsw_lat)^2 )
  return(list(
    long = nzsw_long + t * ( nzne_long - nzsw_long ),
    lat = nzsw_lat + t * (nzne_lat - nzsw_lat )
  ))
}


# Take Kaikoura as 0
# https://en.wikipedia.org/wiki/Kaikoura
zero_ll &lt;- get_projection(173.68, -42.40)

get_nz_cross_section &lt;- function(my_long, my_lat) {
  my_proj &lt;- get_projection(my_long, my_lat)
  return(
    sqrt( (my_proj$long - zero_ll$long)^2 + (my_proj$lat - zero_ll$lat)^2 ) *
      if_else(my_proj$lat &gt;= zero_ll$lat, 1, -1)
  )
}

nz_north &lt;- get_nz_cross_section(178.27514, -37.55764)
nz_south &lt;- get_nz_cross_section(166.66809, -46.20644)

landmarks &lt;- 
  tribble(
    ~name, ~long, ~lat,
    &quot;Dunedin&quot;, 170.5, -45.867,
    &quot;Christchurch&quot;, 172.62, -43.53,
    &quot;Kaikoura&quot;, 173.68, -42.40,
    &quot;Wellington&quot;, 174.777, -41.289,
    #&quot;Hamilton&quot;, 175.283, -37.783,
    &quot;Auckland&quot;, 174.74, -36.84,
    &quot;Gisborne&quot;, 178.018, -38.6625
  ) %&gt;% 
  mutate(cross_section = get_nz_cross_section(long, lat))


eqnz &lt;- 
  eqnz_raw %&gt;% 
  select(origintime, longitude, latitude, magnitude, depth) %&gt;% 
  mutate(time_bucket = floor_date(origintime, unit = &quot;hours&quot;),
         cross_section = get_nz_cross_section(longitude, latitude)) %&gt;% 
  arrange(origintime, magnitude)

ggeq &lt;- 
  ggplot(eqnz) +
  theme_tufte() +
  scale_y_reverse() +
  # &quot;Land&quot; and town labels
  geom_rect(xmin = nz_south, xmax = nz_north, ymin = 0, ymax = 1, fill = &quot;green&quot;) +
  geom_segment(data = landmarks,
               y = 0.2, yend = 2,
               aes(x = cross_section, xend = cross_section)) +
  geom_text(data = landmarks,
            y = 3,
            aes(x = cross_section, label = name)) +
  # Cumulative
  geom_point(aes(x = cross_section, y = depth, size = 2^magnitude,
                 alpha = 0.01, frame = time_bucket, cumulative = TRUE),
             color = &quot;gray&quot;) +
  # Highlight 5-7
  geom_point(data = eqnz %&gt;% filter(magnitude &gt;= 7),
             aes(x = cross_section, y = depth, size = 2 * 2^magnitude, frame = time_bucket),
             color = &quot;red&quot;) +
  geom_point(data = eqnz %&gt;% filter(magnitude &gt;= 6, magnitude &lt; 7),
             aes(x = cross_section, y = depth, size = 2 * 2^magnitude, frame = time_bucket),
             color = &quot;green&quot;) +
  geom_point(data = eqnz %&gt;% filter(magnitude &gt;= 5, magnitude &lt; 6),
             aes(x = cross_section, y = depth, size = 2 * 2^magnitude, frame = time_bucket),
             color = &quot;blue&quot;) +
  # As they come
  geom_point(aes(x = cross_section, y = depth, size = 2^magnitude, frame = time_bucket)) +
  #scale_size(range = c(1,30)) + 
  scale_radius(range = c(1, 30)) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        legend.position = &quot;none&quot;) +
  labs(caption = &quot;David Friggens [CC-BY] http://david.frigge.nz&quot;) +
  ylab(&quot;Depth (km)&quot;) +
  ggtitle(&quot;New Zealand Earthquakes (&gt;M2)&quot;)
  

gg_animate(ggeq, 
           interval = 0.8, 
           ani.width = 800, ani.height = 600,
           filename = &quot;images/eqnz_depth.gif&quot;)</code></pre>
<p><img src="images/eqnz_depth.gif" alt="Animated 1d map of earthquake depth" /></p>
<p>Alternatively, we could look at depth against time.</p>
<pre class="r"><code>ggeq2 &lt;- 
  ggplot(eqnz) +
  theme_tufte() +
  scale_y_reverse() +
  # Highlight 5-7
  geom_point(data = eqnz %&gt;% filter(magnitude &gt;= 7),
             aes(x = origintime, y = depth, size = 2 * 2^magnitude, frame = time_bucket, cumulative = TRUE),
             color = &quot;red&quot;) +
  geom_point(data = eqnz %&gt;% filter(magnitude &gt;= 6, magnitude &lt; 7),
             aes(x = origintime, y = depth, size = 2 * 2^magnitude, frame = time_bucket, cumulative = TRUE),
             color = &quot;green&quot;) +
  geom_point(data = eqnz %&gt;% filter(magnitude &gt;= 5, magnitude &lt; 6),
             aes(x = origintime, y = depth, size = 2 * 2^magnitude, frame = time_bucket, cumulative = TRUE),
             color = &quot;blue&quot;) +
  # As they come
  geom_point(aes(x = origintime, y = depth, size = 2^magnitude, 
                 frame = time_bucket, cumulative = TRUE)) +
  #scale_size(range = c(1,30)) + 
  scale_radius(range = c(1, 30)) +
  theme(legend.position = &quot;none&quot;) +
  labs(caption = &quot;David Friggens [CC-BY] http://david.frigge.nz&quot;) +
  ylab(&quot;Depth (km)&quot;) + xlab(&quot;&quot;) +
  ggtitle(&quot;New Zealand Earthquakes (&gt;M2)&quot;)

gg_animate(ggeq2, 
           interval = 0.2, 
           ani.width = 800, ani.height = 600,
           filename = &quot;images/eqnz_depth_time.gif&quot;)</code></pre>
<p><img src="images/eqnz_depth_time.gif" alt="Animated plot of depth against time" /></p>
<p>In both these plots you can see that not much was happening on Sunday, but we started getting pummelled by quakes from midnight, Monday morning. (Two minutes past midnight, to be specific — I remember it well!) A few are quite deep down, but most — especially the big ones — are relatively shallow.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>And provides excellent <a href="htts://twitter.com/geonet">live notifications</a>.<a href="#fnref1">↩</a></p></li>
</ol>
</div>

<hr />

<footer>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="images/cc.png" /></a><br />This site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30013353-2', 'auto');
  ga('send', 'pageview');

</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>


</body>
</html>
